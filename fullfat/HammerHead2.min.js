/*! HammerHead2 22-06-2014 */
function interpolate(a){var b=0;return function(c){return a.replace(/%(?:\(([^)]+)\))?([%diouxXeEfFgGcrs])/g,function(a,d,e){return"%"==e?"%":c[d||b++]})}}var argsToList=function(a){return Array.prototype.slice.call(a)},isArray=function(a){return a&&a.constructor===Array},isObj=function(a){return"object"==typeof a&&!isArray(a)},isDefined=function(a){return void 0!==a},_=function(){function a(a){return function(b){for(var c=0;c<b.length;c++)a(b[c],c)}}function b(a){return function(b){for(var c=b.length-1;c>-1;c--)a(b[c],c)}}function c(b){return function(c){a(function(a){b(c[a],a)})(Object.keys(c))}}function d(b){return function(d){arguments.length>1&&(d=argsToList(arguments)),isArray(d)?a(b)(d):c(b)(d)}}function e(b){return function(c){var d=[];return a(function(a,c){d.push(b(a,c))})(c),M?Object.freeze(d):d}}function f(a){return function(b){var d={};return c(function(b,c){d[c]=a(b,c)})(b),M?Object.freeze(d):d}}function g(a){return function(b){return arguments.length>1&&(b=argsToList(arguments)),isArray(b)?e(a)(b):f(a)(b)}}function h(b){return function(c){var d=[];return a(function(a,c){b(a,c)&&d.push(a)})(c),M?Object.freeze(d):d}}function i(a){return function(b){var d={};return c(function(b,c){a(b,c)&&(d[c]=b)})(b),M?Object.freeze(d):d}}function j(a){return function(b){return arguments.length>1&&(b=argsToList(arguments)),isArray(b)?h(a)(b):i(a)(b)}}function k(a){return function(b){return function(){var c=a;return d(function(a,d){c=isDefined(c)?b(c)(a,d):a}).apply({},arguments),c}}}function l(a){return a=a||C,function(){var b=!0;return d(function(c,d){b=b&&a(c,d)}).apply({},arguments),b}}function m(a){return a=a||C,function(){var b=!1;return d(function(c,d){b=b||a(c,d)}).apply({},arguments),b}}function n(a){return a=a||C,function(){var b;return d(function(c){b=b&&a(b)<a(c)?b:c}).apply({},arguments),b}}function o(a){return a=a||C,function(){var b;return d(function(c){b=b&&a(b)>a(c)?b:c}).apply({},arguments),b}}function p(a){return function(b){return a=0>a?b.length+a:a,[b.slice(0,a),b.slice(a)]}}function q(b){var c=[];return A(b)(function(){c.push([])}),function(d){return a(function(a,d){c[d%b].push(a)})(d),c}}function r(a){return arguments.length>1&&(a=argsToList(arguments)),function(b){return-1!==a.indexOf(b)}}function s(a){return function(b){return c(function(a,c){b[c]=a})(a),b}}function t(a){return function(b){return c(function(b,c){a[c]=b})(b),a}}function u(a){return function(b){var e={};return d(c(function(a,b){e[b]=a}))(a||{},b||{}),M?Object.freeze(e):e}}function v(a){return function(b){var e={};return d(c(function(a,b){e[b]=a}))(b||{},a||{}),M?Object.freeze(e):e}}function w(){var a=arguments;return function(){var c=arguments;return b(function(a){c=[a.apply(this,c)]})(a),c[0]}}function x(){var a=arguments;return function(b){return b.apply({},a)}}function y(a){return function(b){var c,d;return function(){d=arguments,clearTimeout(c),c=setTimeout(function(){b.apply({},d)},a)}}}function z(a){return function(b){var c,d;return function(){d=arguments,c||(c=setTimeout(function(){c=null,b.apply({},d)},a))}}}function A(a){return function(b){for(var c=0;a>c;c++)b(c)}}function B(a){return function(){return!a.apply({},arguments)}}function C(a){return a}function D(a){return function(b){return isArray(a)||isObj(a)?g(x(b))(g(D)(a)):b[a]}}function E(a){return function(){return Math.random()*a|0}}function F(b){var c=b.split(" ");a(function(a){window[a]=R[a]})(c)}function G(){M=!1}function H(){M=!0}function I(a){return a.length||Object.keys(a).length}function J(){console.log.apply(console,arguments)}function K(a){return function(b,c){return a(c)}}function L(a){return function(b){return a===b}}var M=!0,N=w(h,B),O=w(i,B),P=w(j,B),Q=Date.now||function(){return(new Date).getTime()},R={eachArray:a,eachArrayRight:b,eachObject:c,each:d,mapArray:e,mapObject:f,map:g,filterArray:h,rejectArray:N,filterObject:i,rejectObject:O,filter:j,reject:P,reduce:k,all:l,any:m,min:n,max:o,cyclic:q,cleave:p,within:r,extend:s,augment:t,foundation:u,overlay:v,compose:w,invoke:x,debounce:y,throttle:z,not:B,I:C,dot:D,now:Q,times:A,random:E,expose:F,defreeze:G,refreeze:H,size:I,log:J,position:K,equals:L};return R}();!function(a){a.round=function(a){a=a||0;var b=Math.pow(10,a),c=Math.pow(.1,a+1);return function(a){return Math.round(a*b+c)/b}}}(_),!function(a){a.pluck=a.compose(a.map,a.dot),a.pick=a.compose(a.filter,a.position,a.within),a.omit=a.compose(a.filter,a.position,a.not,a.within)}(_),function(a){"use strict";function b(){function a(a){return function(b){var c=d[a]=d[a]||{};return c[++e]=b,e}}function b(a){return function(b){var c=!1;return _.eachObject(function(d){d(b,a),c=!0})(d[a]||{}),c}}function c(a){return function(b){b?delete d[a][b]:d[a]={}}}var d={},e=-1;return{subscribe:a,unsubscribe:c,publish:b}}var c;a.Belfry={getTower:function(){return c||(c=b()),c}}}(this);var SVGroovy={};!function(a){"use strict";function b(a,b){if(isObj(a)){if(a.x)return c(a);if(a.pageX)return d(a);if(a.deltaX)return e(a)}var f=m.createSVGPoint();return f.x=a||0,f.y=b||0,Object.freeze(f)}function c(a){return b(a.x,a.y)}function d(a){return b(a.pageX,a.pageY)}function e(a){return b(a.deltaX,a.deltaY)}function f(a){return function(c){return b(a.x+c.x,a.y+c.y)}}function g(a){return function(c){return b(a.x-c.x,a.y-c.y)}}function h(a){return function(c){return c=c||b(),b(c.x-a.x,c.y-a.y)}}function i(a){return function(c){return b(a*c.x,a*c.y)}}function j(a){return function(c){var d=a.x<c.x?a.x:c.x,e=a.y<c.y?a.y:c.y;return b(d,e)}}function k(a){return function(c){var d=a.x>c.x?a.x:c.x,e=a.y>c.y?a.y:c.y;return b(d,e)}}function l(a){return function(b){return Object.freeze(b.matrixTransform(a))}}{var m=document.createElementNS("http://www.w3.org/2000/svg","svg");m.createSVGPoint()}a.Point=_.extend({createFromCoordinate:c,createFromPagePoint:d,createFromDisplacementVector:e,add:f,subtract:g,negate:h,scalar:i,min:j,max:k,matrixTransform:l})(b)}(SVGroovy),function(a){"use strict";function b(){return c.createSVGMatrix()}var c=document.createElementNS("http://www.w3.org/2000/svg","svg");a.Matrix=b,a.Matrix.scaling=function(a){return b().scale(a)},a.Matrix.translating=function(a,c){return b().translate(a,c)}}(SVGroovy),function(){for(var a=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b){var c=(new Date).getTime(),d=Math.max(0,16-(c-a)),e=window.setTimeout(function(){b(c+d)},d);return a=c+d,e}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})}();var hammertime=Hammer(document),Hammerhead={};!function(a){function b(a,b){return"string"==typeof a?c(a):Object.freeze({minimal:a,maximal:b})}function c(a){function c(a){return parseInt(a,10)}var d=a.split(" ").map(c),e=i(d[0],d[1]),f=i(d[2],d[3]),g=i.add(e)(f);return b(e,g)}function d(a){var b=a.minimal.x,c=a.minimal.y,d=a.maximal.x,e=a.maximal.y,f=[b,c,d-b,e-c];return f.join(" ")}function e(a){return i.scalar(.5)(i.add(a.minimal)(a.maximal))}function f(a){return function(b){var c=_.map(i.negate(a));return Object.freeze(c(b))}}function g(a){return function(b){var c=_.map(i.scalar(1/a));return Object.freeze(c(b))}}function h(a){return function(b){return function(c){return b=b||e(c),_.compose(f(i.negate(b)()),g(a),f(b))(c)}}}var i=SVGroovy.Point,j=_.extend({midpoint:e,translate:f,scale:g,zoom:h,attrString:d});j(b),a.ViewBox=b}(Hammerhead),function(a){function b(b){var c,d,e;d=c=e=a.ViewBox(b.getAttribute("viewBox"));var f=Object.create(prototype);return _.extend({getCurrent:function(){return d},getTemporary:function(){return c},setTemporary:function(a){c=a},fix:function(){d=c},getScreenCTM:function(){return b.getScreenCTM()}})(f),f}var c=a.ViewBox,d=SVGroovy.Point;prototype={translate:function(a){var b=c.translate(a)(this.getCurrent());return this.setTemporary(b),this},scale:function(a,b){var d=c.zoom(a)(b)(this.getCurrent());return this.setTemporary(d),this},drag:function(a){var b=this.scaleTo()(a);return this.translate(b)},zoom:function(a,b){var c;return b&&(c=this.mapTo()(b)),this.scale(a,c)},mapTo:function(){return d.matrixTransform(this.getScreenCTM().inverse())},scaleTo:function(){var a=this.getScreenCTM().inverse();return a.e=0,a.f=0,d.matrixTransform(a)}},a.AgileView=b}(Hammerhead),function(a){function b(a,b){var c=d(b),f=c.overflowSurplus,g=2*f+1,h=a.parent();return _.debounce(c.resizeDelay)(function(){var b=h.height(),c=h.width();a.css("margin",e({height:b*f,width:c*f})).width(c*g).height(b*g)})}var c=Belfry.getTower(),d=_.foundation({overflowSurplus:.5,resizeDelay:200}),e=interpolate("-%(height)spx -%(width)spx");$(window).on("resize",c.publish("windowResize")),a.regulateOverflow=function(a,d){var e=b(a,d);e(),c.subscribe("windowResize")(e)}}(Hammerhead),function(a){function b(a){return a.target.ownerSVGElement===this.getElement()&&(this.handlers.touch=!1,this.handlers.drag=c,this.handlers.pinch=d,this.handlers.release=e,g(this.getElement())),this}function c(a){return h({element:this.getElement(),delta:SVGroovy.Point(a.gesture)}),this}function d(a){return this.handlers.drag=!1,i({element:this.getElement(),center:SVGroovy.Point(a.gesture.center),scale:a.gesture.scale}),this}function e(){return this.handlers.touch=b,this.handlers.drag=!1,this.handlers.pinch=!1,j({element:this.getElement()}),this}var f=Belfry.getTower(),g=f.publish("start"),h=f.publish("drag"),i=f.publish("pinch"),j=f.publish("end");a.touchDispatch=function(a){function c(a){a.gesture.preventDefault(),e.handlers[a.type]&&(e=e.handlers[a.type].call(e,a))}var d=a[0],e=Object.create({});return e.getElement=function(){return d},e.handlers={touch:b},e.activate=function(){hammertime.on("touch drag pinch release",c)},e.deactivate=function(){hammertime.off("touch drag pinch release",c)},e.activate(),e}}(Hammerhead),function(a){var b=Belfry.getTower(),c=interpolate("matrix(%(a)s, %(b)s, %(c)s, %(d)s, %(e)s, %(f)s)"),d=SVGroovy.Matrix,e=d(),f=SVGroovy.Point,g=b.subscribe("start"),h=b.subscribe("drag"),i=b.subscribe("pinch"),j=b.subscribe("end");a.managePosition=function(a){function b(){a.css({"-webkit-transform":u,"-ms-transform":u,transform:u}),t=requestAnimationFrame(b)}function k(){t=requestAnimationFrame(b)}var l=a.width(),m=a.height(),n=a[0].getScreenCTM().a,o=a.attr("viewBox").split(" ")[2],p=a.attr("viewBox").split(" ")[3],q=o*n/l,r=p*n/m,s=q>r?q:r;s=_.round(1)(s);var t,u,v=Hammerhead.AgileView(a[0]);g(function(){k()}),h(function(a){u=c(d.translating(a.delta.x,a.delta.y));var b=f(a.delta),e=f.scalar(s)(b);v.drag(e)}),i(function(a){u=c(d.scaling(a.scale)),v.zoom(a.scale)}),j(function(){v.fix(),vbString=Hammerhead.ViewBox.attrString(v.getCurrent()),u=c(e),cancelAnimationFrame(t),requestAnimationFrame(function(){a.attr("viewBox",vbString),a.css({"-webkit-transform":u,"-ms-transform":u,transform:u})})}),a.css({"-webkit-transform":c(e),transform:c(e),"-webkit-backface-visibility":"hidden","-webkit-transform-origin":"50% 50%","-ms-transform-origin":"50% 50%","transform-origin":"50% 50%"})}}(Hammerhead),function(a){function b(a){return function(b){return(b.ownerSVGElement||b)===a}}var c=Belfry.getTower(),d=c.publish("start"),e=c.publish("pinch"),f=c.publish("end"),g=_.foundation({mousewheelSensitivity:.1});a.mousewheelDispatch=function(a,c){c=g(c);var h,i=a[0],j=b(i),k=1+c.mousewheelSensitivity,l=_.debounce(200)(function(){f("wheel"),h=null});$(document).on("mousewheel",function(a){if(!h){if(!j(a.target))return;h=1,d("wheel")}a.wheelDelta>0?h*=k:h/=k,e({element:i,scale:h}),l()})}}(Hammerhead),function(a){function b(b,e){return $svg=$("svg#"+b),$svg[0]?(e=e||{},a.regulateOverflow($svg,d(e)),a.touchDispatch($svg),a.managePosition($svg),void a.mousewheelDispatch($svg,c(e))):!1}var c=_.pick("mousewheelSensitivity"),d=_.pick("overflowSurplus");a.create=b}(Hammerhead);