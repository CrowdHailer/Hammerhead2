/*! HammerHead2 01-06-2014 */
function interpolate(a){var b=0;return function(c){return a.replace(/%(?:\(([^)]+)\))?([%diouxXeEfFgGcrs])/g,function(a,d,e){return"%"==e?"%":c[d||b++]})}}!function(){for(var a=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b){var c=(new Date).getTime(),d=Math.max(0,16-(c-a)),e=window.setTimeout(function(){b(c+d)},d);return a=c+d,e}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})}();var hammertime=Hammer(document),Hammerhead={};!function(a){function b(a,b){return"string"==typeof a?c(a):Object.freeze({minimal:a,maximal:b})}function c(a){function c(a){return parseInt(a,10)}var d=a.split(" ").map(c),e=i(d[0],d[1]),f=i(d[2],d[3]),g=i.add(e)(f);return b(e,g)}function d(a){var b=a.minimal.x,c=a.minimal.y,d=a.maximal.x,e=a.maximal.y,f=[b,c,d-b,e-c];return f.join(" ")}function e(a){return i.scalar(.5)(i.add(a.minimal)(a.maximal))}function f(a){return function(b){var c=_.map(i.negate(a));return Object.freeze(c(b))}}function g(a){return function(b){var c=_.map(i.scalar(1/a));return Object.freeze(c(b))}}function h(a){return function(b){return function(c){return b=b||e(c),_.compose(f(i.negate(b)()),g(a),f(b))(c)}}}var i=SVGroovy.Point,j=_.extend({midpoint:e,translate:f,scale:g,zoom:h,attrString:d});j(b),a.ViewBox=b}(Hammerhead),function(a){function b(b){var c,d,e;d=c=e=a.ViewBox(b.getAttribute("viewBox"));var f=Object.create(prototype);return _.extend({getCurrent:function(){return d},getTemporary:function(){return c},setTemporary:function(a){c=a},fix:function(){d=c},getScreenCTM:function(){return b.getScreenCTM()}})(f),f}var c=a.ViewBox,d=SVGroovy.Point;prototype={translate:function(a){var b=c.translate(a)(this.getCurrent());return this.setTemporary(b),this},scale:function(a,b){var d=c.zoom(a)(b)(this.getCurrent());return this.setTemporary(d),this},drag:function(a){var b=this.scaleTo()(a);return this.translate(b)},zoom:function(a,b){var c;return b&&(c=this.mapTo()(b)),this.scale(a,c)},mapTo:function(){return d.matrixTransform(this.getScreenCTM().inverse())},scaleTo:function(){var a=this.getScreenCTM().inverse();return a.e=0,a.f=0,d.matrixTransform(a)}},a.AgileView=b}(Hammerhead),function(a){function b(a){return $parent=a.parent(),function(){var b=$parent.height(),c=$parent.width();a.css("margin",-b/2+" "+-c/2),a.width(2*c),a.height(2*b)}}var c=Belfry.getTower(),d=_.debounce(200)(c.publish("windowResize"));$(window).on("resize",function(){d()}),a.regulateOverflow=function(a){var d=b(a);d(),c.subscribe("windowResize")(d)}}(Hammerhead),function(a){function b(a){return a.target.ownerSVGElement===this.getElement()?(this.handlers.drag=c,this.handlers.pinch=d,this.handlers.release=e,g(this.getElement()),this):this}function c(a){return this.handlers.pinch=!1,h({element:this.getElement(),delta:{x:a.gesture.deltaX,y:a.gesture.deltaY}}),this}function d(a){return this.handlers.drag=!1,i({element:this.getElement(),center:a.gesture.center,scale:a.gesture.scale}),this}function e(a){return this.handlers.drag=!1,this.handlers.pinch=!1,j({element:this.getElement(),center:a.gesture.center,scale:a.gesture.scale}),this}var f=Belfry.getTower(),g=f.publish("start"),h=f.publish("drag"),i=f.publish("pinch"),j=f.publish("end");a.touchDispatch=function(a){function c(a){a.gesture.preventDefault(),e.handlers[a.type]&&(e=e.handlers[a.type].call(e,a))}var d=a[0],e=Object.create({});e.getElement=function(){return d},e.handlers={touch:b},e.activate=function(){hammertime.on("touch drag pinch release",c)},e.deactivate=function(){hammertime.off("touch drag pinch release",c)},e.activate()}}(Hammerhead),function(a){var b=interpolate("matrix(%(a)s, %(b)s, %(c)s, %(d)s, %(e)s, %(f)s)"),c=SVGroovy.Matrix();tower=Belfry.getTower();var d=(tower.subscribe("start"),tower.subscribe("drag")),e=tower.subscribe("pinch"),f=tower.subscribe("end");a.managePosition=function(a){function g(){a.css({"-webkit-transform":j,"-ms-transform":j,transform:j}),l=requestAnimationFrame(g)}function h(){l=requestAnimationFrame(g)}function i(){}var j,k=Hammerhead.AgileView(a[0]);d(function(a){var c=SVGroovy.Matrix.translating(a.delta.x,a.delta.y);j=b(c),pt=SVGroovy.Point(a.delta),k.drag(pt)}),e(function(a){var c=SVGroovy.Matrix.scaling(a.scale);j=b(c),pt=SVGroovy.Point(a.center),k.zoom(a.scale)}),f(function(){k.fix();var d=Hammerhead.ViewBox.attrString(k.getCurrent());console.log(d),j=b(c),a.attr("viewBox",d)});var l;tower.subscribe("start")(function(){h()}),tower.subscribe("end")(function(){i()}),a.css({"-webkit-transform":b(c),transform:b(c),"-webkit-backface-visibility":"hidden","-webkit-transform-origin":"50% 50%","-ms-transform-origin":"50% 50%","transform-origin":"50% 50%"})}}(Hammerhead),function(a){function b(b){return $svg=$("svg#"+b),$svg[0]?(a.regulateOverflow($svg),a.touchDispatch($svg),void a.managePosition($svg)):!1}a.create=b}(Hammerhead);