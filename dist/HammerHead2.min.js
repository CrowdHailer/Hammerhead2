/*! HammerHead2 24-06-2014 */
function interpolate(a){var b=0;return function(c){return a.replace(/%(?:\(([^)]+)\))?([%diouxXeEfFgGcrs])/g,function(a,d,e){return"%"===e?"%":c[d||b++]})}}function missingCTM(a){var b=a.width(),c=a.height(),d=a[0].getScreenCTM().a,e=a.attr("viewBox").split(" ")[2],f=a.attr("viewBox").split(" ")[3],g=e*d/b,h=f*d/c,i=g>h?g:h;return _.round(1)(i)}function checkSVGTarget(a){return function(b){return(b.ownerSVGElement||b)===a}}var transformObject=function(a){return{"-webkit-transform":a,"-ms-transform":a,transform:a}};!function(){for(var a=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b){var c=(new Date).getTime(),d=Math.max(0,16-(c-a)),e=window.setTimeout(function(){b(c+d)},d);return a=c+d,e}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})}(),_.debounce=function(a){return function(b){var c,d;return function(){var e=this;d=arguments,clearTimeout(c),c=setTimeout(function(){b.apply(e,d)},a)}}},_.peruse=function(a){return function(b){return a[b]}},SVGroovy.Matrix.asCss=function(a){return interpolate("matrix(%(a)s, %(b)s, %(c)s, %(d)s, %(e)s, %(f)s)")(a||SVGroovy.Matrix())},SVGroovy.Matrix.forTranslation=function(a){return SVGroovy.Matrix.translating(a.x,a.y)},SVGroovy.Matrix.forMagnification=function(a){return SVGroovy.Matrix.scaling(a)};var hammertime=Hammer(document),Hammerhead={};!function(a){function b(a,b){return"string"==typeof a?c(a):Object.freeze({minimal:a,maximal:b})}function c(a){function c(a){return parseInt(a,10)}var d=a.split(" ").map(c),e=i(d[0],d[1]),f=i(d[2],d[3]),g=i.add(e)(f);return b(e,g)}function d(a){var b=a.minimal.x,c=a.minimal.y,d=a.maximal.x,e=a.maximal.y,f=[b,c,d-b,e-c];return f.join(" ")}function e(a){return i.scalar(.5)(i.add(a.minimal)(a.maximal))}function f(a){return function(b){var c=_.map(i.negate(a));return Object.freeze(c(b))}}function g(a){return function(b){var c=_.map(i.scalar(1/a));return Object.freeze(c(b))}}function h(a){return function(b){return function(c){return b=b||e(c),_.compose(f(i.negate(b)()),g(a),f(b))(c)}}}var i=SVGroovy.Point,j=_.extend({midpoint:e,translate:f,scale:g,zoom:h,attrString:d});j(b),a.ViewBox=b}(Hammerhead),function(a){function b(){var a=this.getConfig("overflowSurplus"),b=2*a+1,c=this.$element.parent();return _.debounce(this.getConfig("resizeDelay"))(function(){var e=c.height(),f=c.width();this.$element.css("margin",d({height:e*a,width:f*a})).width(f*b).height(e*b)}).bind(this)}var c=Belfry.getTower(),d=interpolate("-%(height)spx -%(width)spx");$(window).on("resize",c.publish("windowResize")),a.regulateOverflow=function(){var a=b.call(this);a(),c.subscribe("windowResize")(a)}}(Hammerhead),function(a){function b(a){return a.target.ownerSVGElement===this.getElement()&&(this.handlers.touch=!1,this.handlers.drag=c,this.handlers.pinch=d,this.handlers.release=e,g(this.getElement())),this}function c(a){return h({element:this.getElement(),delta:SVGroovy.Point(a.gesture)}),this}function d(a){return this.handlers.drag=!1,i({element:this.getElement(),center:SVGroovy.Point(a.gesture.center),scale:a.gesture.scale}),this}function e(a){return this.handlers.touch=b,this.handlers.drag=!1,this.handlers.pinch=!1,j({element:this.getElement(),delta:SVGroovy.Point(a.gesture),scale:a.gesture.scale}),this}var f=Belfry.getTower(),g=f.publish("start"),h=f.publish("drag"),i=f.publish("pinch"),j=f.publish("end");a.touchDispatch=function(a){function c(a){a.gesture.preventDefault(),e.handlers[a.type]&&(e=e.handlers[a.type].call(e,a))}var d=a[0],e=Object.create({});return e.getElement=function(){return d},e.handlers={touch:b},e.activate=function(){hammertime.on("touch drag pinch release",c)},e.deactivate=function(){hammertime.off("touch drag pinch release",c)},e.activate(),e}}(Hammerhead),function(a){var b=Belfry.getTower(),c=SVGroovy.Point,d=SVGroovy.Matrix,e=a.ViewBox,f=b.subscribe("start"),g=b.subscribe("drag"),h=b.subscribe("pinch"),i=b.subscribe("end"),j=_.compose(transformObject,d.asCss);a.managePosition=function(){function a(){q.css(j(p)),l=requestAnimationFrame(a)}function k(){l=requestAnimationFrame(a)}var l,m,n,o,p,q=this.$element,r=missingCTM(q),s=1,t=viewBox=e(q.attr("viewBox"));f(function(){k(),n=this.getConfig("maxZoom")/s,o=this.getConfig("minZoom")/s,m=1}.bind(this)),g(function(a){p=d.forTranslation(a.delta)}),h(function(a){var b=Math.max(Math.min(a.scale,n),o);p=d.forMagnification(b),m=b}),i(function(a){if(1===m){var b=c.scalar(r)(a.delta),f=q[0].getScreenCTM().inverse();f.e=0,f.f=0;var g=c.matrixTransform(f),h=g(b);viewBox=e.translate(h)(viewBox)}else{var i=Math.max(Math.min(m,n),o);s*=i,viewBox=e.zoom(i)()(viewBox)}cancelAnimationFrame(l),p=d(),requestAnimationFrame(function(){q.attr("viewBox",e.attrString(e.zoom(.5)()(viewBox))),q.css(j())})}),q.css(j()),q.attr("viewBox",e.attrString(e.zoom(.5)()(viewBox))),b.subscribe("home")(function(){q.css(j()),viewBox=t,q.attr("viewBox",e.attrString(e.zoom(.5)()(viewBox)))})}}(Hammerhead),function(a){var b=Belfry.getTower(),c=b.publish("start"),d=b.publish("pinch"),e=b.publish("end");a.mousewheelDispatch=function(){var a,b=this.$element[0],f=1+this.getConfig("mousewheelSensitivity"),g=_.debounce(this.getConfig("mousewheelDelay"))(function(b){e({scale:b}),a=null}),h=function(e){if(!a){if(!this.isComponent(e.target))return;a=1,c("wheel")}e.wheelDelta>0?a*=f:a/=f,d({element:b,scale:a}),g(a)}.bind(this);$(document).on("mousewheel",h)}}(Hammerhead),function(a){"use strict";function b(b,c){var g=$("svg#"+b),h=g[0];if(!h)return console.warn(f({id:b})),!1;var i=Object.create(d);return i.$element=g,i.element=h,i.isComponent=checkSVGTarget(h),i.getConfig=_.peruse(e(c)),a.regulateOverflow.call(i),a.touchDispatch(g),a.managePosition.call(i),a.mousewheelDispatch.call(i),i}var c=Belfry.getTower(),d={home:function(){c.publish("home")(this.$element[0])}},e=_.foundation({mousewheelSensitivity:.1,mousewheelDelay:200,maxZoom:2,minZoom:.5,overflowSurplus:.5,resizeDelay:200}),f=interpolate("SVG element '%(id)s' not found");a.create=b}(Hammerhead);